function whichDevice(){var a=navigator.userAgent.toLowerCase(),b=new Array("iphone os 5","ipad; cpu os 5","iphone","ipad","android 2","android","blackberry","palmos");for(var c in b)if(a.indexOf(b[c])>=0)return b[c]}function whichTransitionEndEvent(){var a,b=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}var transitionEndEvent=whichTransitionEndEvent(),ScreenView=Backbone.View.extend({tagName:"section",className:"screen",templates:{start:_.template($("#start").html())},initialize:function(){this.render()},render:function(){this.$el.html(this.templates[app.get("state")])}}),Router=Backbone.Router.extend({routes:{"":"start"},start:function(){app.set("state","start")}}),router=new Router;Backbone.history.start();var App=Backbone.Model.extend({defaults:{state:"start"}}),app=new App,AppView=Backbone.View.extend({model:app,id:"app",screens:[],initialize:function(){this.render(),this.model.on("change:state",this.changeScreens,this),this.createScreen()},render:function(){$("body").prepend(this.$el)},events:{"transitionend .oldScreen, oTransitionEnd .oldScreen, webkitTransitionEnd .oldScreen":function(){this.screens[0].unbind(),this.screens[0].remove(),this.screens.shift();var a=this.afterScreenTransitionCalls[this.model.get("state")+"AfterCall"];"function"==typeof a&&a(),$(".screen-newScreen").removeClass("screen-newScreen"),$("body").removeClass("s-screenTransition s-reverseTransition")},"click .back":function(a){a.preventDefault(),$("body").addClass("s-reverseTransition"),history.back()}},createScreen:function(){var a=new ScreenView;this.screens.length>0&&a.$el.addClass("screen-newScreen"),this.screens.push(a),this.$el.append(a.$el)},changeScreens:function(){this.createScreen();var a=this.beforeScreenTransitionCalls[this.model.get("state")+"BeforeCall"];"function"==typeof a&&a(),this.screens[0].$el.addClass("screen-oldScreen"),setTimeout(function(){$("body").addClass("s-screenTransition")},10)},beforeScreenTransitionCalls:{},afterScreenTransitionCalls:{}}),appView;$(document).ready(function(){appView=new AppView});