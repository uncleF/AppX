function whichDevice(){var b=navigator.userAgent.toLowerCase();var c=new Array("iphone os 5","ipad; cpu os 5","iphone","ipad","android 2","android","blackberry","palmos");for(var a in c){if(b.indexOf(c[a])>=0){return c[a]}}}function whichTransitionEndEvent(){var a;var c=document.createElement("fakeelement");var b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in b){if(c.style[a]!==undefined){return b[a]}}}var transitionEndEvent=whichTransitionEndEvent();var ScreenView=Backbone.View.extend({tagName:"section",className:"screen",templates:{start:_.template($("#start").html()),},initialize:function(){this.render()},render:function(){this.$el.html(this.templates[app.get("state")])}});var Router=Backbone.Router.extend({routes:{"":"start"},start:function(){app.set("state","start")}});var router=new Router();Backbone.history.start();var App=Backbone.Model.extend({defaults:{state:"start"}});var app=new App();var AppView=Backbone.View.extend({model:app,id:"app",screens:[],initialize:function(){this.render();this.model.on("change:state",this.changeScreens,this);this.createScreen()},render:function(){$("body").prepend(this.$el)},events:{"transitionend .oldScreen, oTransitionEnd .oldScreen, webkitTransitionEnd .oldScreen":function(){this.screens[0].unbind();this.screens[0].remove();this.screens.shift();var a=this.afterScreenTransitionCalls[this.model.get("state")+"AfterCall"];if(typeof a=="function"){a()}$(".screen-newScreen").removeClass("screen-newScreen");$("body").removeClass("s-screenTransition s-reverseTransition")},"click .back":function(a){a.preventDefault();$("body").addClass("s-reverseTransition");history.back()}},createScreen:function(){var a=new ScreenView();if(this.screens.length>0){a.$el.addClass("screen-newScreen")}this.screens.push(a);this.$el.append(a.$el)},changeScreens:function(){this.createScreen();var a=this.beforeScreenTransitionCalls[this.model.get("state")+"BeforeCall"];if(typeof a=="function"){a()}this.screens[0].$el.addClass("screen-oldScreen");setTimeout(function(){$("body").addClass("s-screenTransition")},10)},beforeScreenTransitionCalls:{},afterScreenTransitionCalls:{}});var appView;$(document).ready(function(){appView=new AppView()});